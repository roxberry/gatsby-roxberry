{
    "componentChunkName": "component---src-templates-blog-js",
    "path": "/development/2021/07/25/github-action-gatsby/",
    "result": {"data":{"markdownRemark":{"excerpt":"Why? The gatsby template includes scripting to deploy from whereever you cloned your code.  It works just fine and is reliable whenâ€¦","frontmatter":{"title":"Github Action for Gatsby Publish","subtitle":"Steps to enable gatbsy publish on a push to main branch","date":"July 25, 2021","author":"Mark Roxberry","featured":true,"postimage":{"alt":"main post image","src":{"absolutePath":"/home/runner/work/gatsby-roxberry/gatsby-roxberry/temp/src/posts/2021-07-25-github-action-gatsby/post.png","childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQoz2NQy7uvShZSy7vPoEquZlVkzWr599VhCE2RUs59lVzcmtXy78tl3RNLuSudflcs5S7EVap595VzQWYZlj1UzwexsWhWz78vm3HPpeXx8qOfdl/62rzmrUouyCq1PBAZM+l5+/o30ZOeq+eD7AAhuGa1/PvyWfecGp8cv/X99N3vFx78OH//x8w9H+Qy76nk3tcteZAz50X7+je5815qFz2QybinlHNfMQeqn0Gj4L5w0p2FBz6uO/lZMOGOQvY9s8qHz9//dmp6rJB1TzHnvmfbk86Nb0oXv0qa/tyz9UnW7JcuTU8Usu+p5YM1iyTfWXvy8/Ijn4SS7ijn3NctfvDk7e+A7qeymfdU8+5rFz3Im/eifOmrtnVvqpe/mrD1XdyU5zIZ99QhmiXT7qbPennv5a+UGS9V8+6ff/DjxtOf6vn3VcABZlj2IKzvWWjfs9LFL43KH0ZPemZR/UgpBymeFbLuNa5+U7b0tW7xgwsPfvh0gKyFhJBi9j331ifVy1/nzXsZO/m5bd1j+/rHihBnQzSr5IIiU7v4gSo4SuSyQHLwWJTNuGdW9cin44l6wX3r2kc6RQ8g0Y6SwuAxqYaaTtTz7yvl3pPLAgWBIlKCITZ5QmIYnnhI04w9bVOSqwD8RtW8vtGJDAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/4803ffe9dfe9086fa5bde6edf72724b2/c2d17/post.png","srcSet":"/static/4803ffe9dfe9086fa5bde6edf72724b2/76a4f/post.png 750w,\n/static/4803ffe9dfe9086fa5bde6edf72724b2/c2d17/post.png 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/4803ffe9dfe9086fa5bde6edf72724b2/2b382/post.avif 750w,\n/static/4803ffe9dfe9086fa5bde6edf72724b2/6ee87/post.avif 800w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/4803ffe9dfe9086fa5bde6edf72724b2/66907/post.webp 750w,\n/static/4803ffe9dfe9086fa5bde6edf72724b2/0d27e/post.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.75},"resize":{"src":"/static/4803ffe9dfe9086fa5bde6edf72724b2/f3583/post.png","height":900,"width":1200}}}}},"html":"<h2>Why?</h2>\n<p>The gatsby template includes scripting to deploy from whereever you cloned your code.  It works just fine and is reliable when everything is set up on my machine.  The package.json includes the deploy script:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk8\">&quot;scripts&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;deploy&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;gatsby build --prefix-paths &amp;&amp; gh-pages -d public&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span></code></pre>\n<p>However, there are 2 drawbacks for my workflow (and my goal to start writing more):</p>\n<ol>\n<li>You can deploy without a commit and push to the repository</li>\n<li>You can't deploy without running the deploy script, so any work on the site on Github or my iPad won't get deployed until I commit and push on one device and then pull and deploy to the same repo on my computer.  Ain't nobody got time for that.</li>\n</ol>\n<p>I was using a Github Action for my Jekyll site, prior to moving to Gatsby, and that worked when I pushed to branch and kickoff the publish action.  This action was a bit more involved as I was using Azure for a host and it required a few more configuration hurdles to set it up.</p>\n<p>For my current site, I thought it has to be pretty simple - push to main branch, trigger an action, copy to gh-pages branch and that's that.  Turns out, that is that and I was able to get it working pretty fast.</p>\n<p>I documented my steps in case I need to go back and change anything - e.g. I would like to update the siteMetadata.version in the gatsby-config.js file at some point.  Here are the steps</p>\n<h2>Steps to publish a Gatsby site to gh-pages</h2>\n<ol>\n<li>Create a new workflow in the repository Actions section</li>\n</ol>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"yaml\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">name</span><span class=\"mtk1\">: </span><span class=\"mtk8\">Gatsby Publish</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">push</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">branches</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">main</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">jobs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">runs-on</span><span class=\"mtk1\">: </span><span class=\"mtk8\">ubuntu-latest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">steps</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk4\">uses</span><span class=\"mtk1\">: </span><span class=\"mtk8\">actions/checkout@v1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk4\">uses</span><span class=\"mtk1\">: </span><span class=\"mtk8\">enriikke/gatsby-gh-pages-action@v2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">with</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">access-token</span><span class=\"mtk1\">: </span><span class=\"mtk8\">${{ secrets.ACCESS_TOKEN }}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">deploy-branch</span><span class=\"mtk1\">: </span><span class=\"mtk8\">gh-pages</span></span></span></code></pre>\n<ol start=\"2\">\n<li>\n<p>Create a personal access token (PAT), select the <em>repo</em> permission.</p>\n<p><a href=\"https://docs.github.com/en/actions/reference/authentication-in-a-workflow\">Authentication in a Github Action Workflow</a></p>\n</li>\n<li>\n<p>Create a Secret in the repo: ACCESS_TOKEN and use the new PAT token (note the workflow YAML file specifies the ACCESS_TOKEN parameter).</p>\n</li>\n<li>\n<p>Build should kick in and go green</p>\n</li>\n<li>\n<p>Profit?</p>\n<p>And lo and behold, my site is passing (hopefully this shows it's passing):\n<a href=\"https://github.com/roxberry/gatsby-roxberry/actions/workflows/main.yml\"><img src=\"https://github.com/roxberry/gatsby-roxberry/actions/workflows/main.yml/badge.svg\" alt=\"Gatsby Publish\"></a></p>\n</li>\n</ol>\n<h2>Next things</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Improve this post with images from Github</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Add embedded gist for the main.yml</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Config version update (need to think about - should only happen on non posts)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Create a tweet with the title if a post</li>\n</ul>\n<!-- <script src=\"https://gist.github.com/roxberry/f6f58e2212346fd8c699c1d8c8cf8bcf.js\"></script>\n{% gist f6f58e2212346fd8c699c1d8c8cf8bcf %} -->\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>"}},"pageContext":{"slug":"/development/2021/07/25/github-action-gatsby/"}},
    "staticQueryHashes": ["2052298874","2446865869","550521386","717330468"]}